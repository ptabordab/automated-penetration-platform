import * as log4js from 'log4js';
import { runVulnerabilityScan } from './runVulnerabilityScan';
import { Host } from '../types/host';
const axios = require('axios');


export const runVulnerabilityScans = async ( hosts: Host[], token: string, config:any ) => {

    const logger = log4js.getLogger("runVulnerabilityScans");

    const promises:any[] = [];

    hosts.forEach(element => {
        promises.push(runVulnerabilityScan(element.ipAddress, token, config));
    });


    let scanDetails:any[] = [];

    try 
    {
        scanDetails = await Promise.all(promises);
    }
    catch (error: any) 
    {
        logger.error('Failed to initiate scans:', error.response.data.error);
        throw error;
    }

    return scanDetails;
}